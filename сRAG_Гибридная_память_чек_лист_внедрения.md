–æ—Ç–ª–∏—á–Ω–æ ‚Äî –≤–æ—Ç —á–µ–∫-–ª–∏—Å—Ç –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω–æ–π –ø–∞–º—è—Ç–∏ (—Å—Ç—Ä—É–∫—Ç—É—Ä—ã + rolling summary + RAG) –±–µ–∑ –∫–æ–¥–∞, —Ç–æ–ª—å–∫–æ —à–∞–≥–∏.

# –ì–∏–±—Ä–∏–¥–Ω–∞—è –ø–∞–º—è—Ç—å: —á–µ–∫-–ª–∏—Å—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

## 1) –ü–æ–¥–≥–æ—Ç–æ–≤—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

1. –î–æ–±–∞–≤—å –ø–æ–ª—è/—Ç–∞–±–ª–∏—Ü—ã:

   * `messages(id, role, content, created_at, episode_id, tokens, embedding)`
   * `episodes(id, title, started_at, ended_at, short_summary, topic_tags[])`
   * `summaries(id, type: {'rolling','top','episode'}, content, updated_at, source_ids[])`
   * `client_profile(json, updated_at, provenance[])`
   * `decisions(id, text, status, source_id, superseded_by)`
   * `todos(id, text, due_at, status, source_id)`
2. –ò–Ω–¥–µ–∫—Å—ã: –ø–æ `created_at`, `episode_id`, –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç/–≤–µ–∫—Ç–æ—Ä –ø–æ `messages.content`.
3. –î–æ–±–∞–≤—å —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (–æ—Ü–µ–Ω–∫–∞) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ (msg/summary/profile).

## 2) –í–∫–ª—é—á–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (RAG)

4. –í—ã–±–µ—Ä–∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü (sqlite-vss / fts5+–≤–Ω–µ—à–Ω–∏–π –∏–Ω–¥–µ–∫—Å / –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ).
5. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–≤–æ–≥–æ `message` —Å—á–∏—Ç–∞–π `embedding` –∏ —Å–æ—Ö—Ä–∞–Ω—è–π.
6. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π `topic_tags` (–∞–≤—Ç–æ-—Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ 1‚Äì3 —Ç–µ–≥–∞–º).

## 3) –ü–æ–ª–∏—Ç–∏–∫–∞ —ç–ø–∏–∑–æ–¥–æ–≤

7. –û–ø—Ä–µ–¥–µ–ª–∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ ¬´—ç–ø–∏–∑–æ–¥ –∑–∞–∫—Ä—ã—Ç¬ª:

   * —Å–º–µ–Ω–∞ —Ç–µ–º—ã (–Ω–æ–≤—ã–π –∫—Ä—É–ø–Ω—ã–π `topic_tag`),
   * –ø–∞—É–∑–∞ > N —á–∞—Å–æ–≤,
   * –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ —Ü–µ–ª—å/–¥–µ–¥–ª–∞–π–Ω.
8. –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —ç–ø–∏–∑–æ–¥–∞ —Å–æ–∑–¥–∞–π `episode.short_summary` (100‚Äì200 —Ç–æ–∫–µ–Ω–æ–≤).

## 4) Rolling summary (—Å–∫–æ–ª—å–∑—è—â–µ–µ)

9. –î–µ—Ä–∂–∏ –æ–¥–∏–Ω `summaries[type='rolling']` –Ω–∞ –¥–∏–∞–ª–æ–≥ (600‚Äì800 —Ç–æ–∫–µ–Ω–æ–≤).
10. –¢—Ä–∏–≥–≥–µ—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

    * –∫–∞–∂–¥—ã–µ N —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 8),
    * –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–º—ã,
    * –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ñ–∞–∫—Ç–æ–≤/—Ä–µ—à–µ–Ω–∏–π/–¥–µ–¥–ª–∞–π–Ω–æ–≤.
11. –û–±–Ω–æ–≤–ª—è–π **–¥–∏—Ñ—Ñ–æ–º**: —Å—Ç–∞—Ä—ã–π summary + –ø–æ—Å–ª–µ–¥–Ω–∏–µ K —Å–æ–æ–±—â–µ–Ω–∏–π ‚Üí –Ω–æ–≤—ã–π summary.
12. –•—Ä–∞–Ω–∏ `source_ids` –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ–≤).

## 5) Top summary (–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π —Ä–µ—Å–∏–Ω–∫)

13. –†–∞–∑ –≤ M —ç–ø–∏–∑–æ–¥–æ–≤ –∏–ª–∏ —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏ —Å–æ–±–∏—Ä–∞–π `top` (300‚Äì500 —Ç–æ–∫–µ–Ω–æ–≤) –∏–∑ —ç–ø–∏–∑–æ–¥–Ω—ã—Ö short\_summary.
14. –ï—Å–ª–∏ –±—é–¥–∂–µ—Ç –Ω–µ –≤–ª–µ–∑–∞–µ—Ç ‚Äî —É—Ä–µ–∑–∞–π –º–µ–Ω–µ–µ —Å–≤–µ–∂–∏–µ/–º–µ–Ω–µ–µ –≤–∞–∂–Ω—ã–µ —ç–ø–∏–∑–æ–¥—ã.

## 6) –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–∞–º—è—Ç—å (—Å–ª–æ—Ç—ã)

15. –û–ø—Ä–µ–¥–µ–ª–∏ —Å–ª–æ—Ç—ã JSON: –ø—Ä–æ—Ñ–∏–ª—å –∫–ª–∏–µ–Ω—Ç–∞, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è/–Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∫–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è, –∞–∫—Ç–∏–≤–Ω—ã–µ TODO.
16. –ó–∞–≤–µ–¥–∏ **Profiler-–∞–≥–µ–Ω—Ç–∞** (—Ç–æ—Ç –∂–µ LLM, –¥—Ä—É–≥–æ–π –ø—Ä–æ–º–ø—Ç):

    * –≤—Ö–æ–¥: `existing_profile + new_messages`,
    * –≤—ã—Ö–æ–¥: –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π JSON + `provenance`.
17. –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤:

    * –Ω–æ–≤–æ–µ —Ç–æ—á–Ω–µ–µ/—Å–≤–µ–∂–µ–µ ‚Üí –∑–∞–º–µ–Ω–∏—Ç—å —Å –æ—Ç–º–µ—Ç–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏,
    * –Ω–æ–≤–æ–µ —Ä–∞—Å–ø–ª—ã–≤—á–∞—Ç–æ ‚Üí –∏–≥–Ω–æ—Ä,
    * –æ—Ç–º–µ–Ω—ã/–ø–µ—Ä–µ–æ–±—É–≤–∞–Ω–∏–µ ‚Üí –ø–æ–º–µ—Ç–∫–∞ `outdated` –≤ —Ä–µ—à–µ–Ω–∏—è—Ö.

## 7) –°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∫–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç (–∂—ë—Å—Ç–∫–∏–π –±—é–¥–∂–µ—Ç ‚â§1000 —Ç–æ–∫–µ–Ω–æ–≤)

18. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ (–ø—Ä–∏–º–µ—Ä):

    * System/–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: 150
    * Structured memory (–ø—Ä–æ—Ñ–∏–ª—å/—Ä–µ—à–µ–Ω–∏—è/todos): 200‚Äì300
    * Top/rolling summary: 300‚Äì400
    * –ü–æ—Å–ª–µ–¥–Ω–∏–µ L —Å–æ–æ–±—â–µ–Ω–∏–π: 200‚Äì250
    * RAG-–≤—Å—Ç–∞–≤–∫–∞ (3‚Äì7 —Ä–µ–ø–ª–∏–∫): –æ—Å—Ç–∞—Ç–æ–∫
19. –ü–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π –æ—Ü–µ–Ω–∏ —Ç–æ–∫–µ–Ω—ã –±–ª–æ–∫–æ–≤; –µ—Å–ª–∏ >1000:

    * —Å–Ω–∞—á–∞–ª–∞ —É–º–µ–Ω—å—à–∏ L (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å 10 –¥–æ 6),
    * –∑–∞—Ç–µ–º —É—Ä–µ–∂—å rolling –Ω–∞ 15‚Äì20%,
    * **–Ω–µ —Ä–µ–∂—å** –ø—Ä–æ—Ñ–∏–ª—å/—Ä–µ—à–µ–Ω–∏—è –±–µ–∑ –∫—Ä–∞–π–Ω–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

## 8) RAG-–≤—ã–±–æ—Ä–∫–∞ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏

20. –ó–∞–ø—Ä–æ—Å: –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –≤—ã—á–∏—Å–ª–∏ embedding.
21. –°–∫–æ—Ä–∏–Ω–≥: `score = 0.6*similarity + 0.3*recency - 0.1*dupPenalty`.
22. –í—ã–±–µ—Ä–∏ top-M —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 3‚Äì5) —Å —Ä–∞–∑–Ω—ã–º–∏ `episode_id` (–¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è).
23. –û—Ç—Ñ–∏–ª—å—Ç—Ä—É–π –¥—É–±–ª–∏/—Ü–∏—Ç–∞—Ç—ã, –æ—Å—Ç–∞–≤—å —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω–æ –ø–æ–ª–µ–∑–Ω—ã–µ –∫—É—Å–∫–∏.

## 9) –¢—Ä–∏–≥–≥–µ—Ä—ã –∏ TTL

24. TTL: —Å–Ω–∏–∂–∞–π –≤–µ—Å —Å–æ–æ–±—â–µ–Ω–∏–π —Å—Ç–∞—Ä—à–µ X –¥–Ω–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, ‚àí20%/–Ω–µ–¥–µ–ª—è).
25. –°–æ–±—ã—Ç–∏—è: ¬´–ó–∞–ø–æ–º–Ω–∏/–û—Ç–º–µ–Ω–∏/–ü—Ä–∞–≤–∫–∞¬ª ‚Äî –≤—Å–µ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—é—Ç Profiler + Rolling summary.
26. –ï—Å–ª–∏ —Ü–µ–ª—å/–∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ ‚Äî –ø–µ—Ä–µ–º–µ—Å—Ç–∏ –µ—ë –≤ `decisions.status = done`.

## 10) –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞

27. **Validator-–∞–≥–µ–Ω—Ç** (–ª—ë–≥–∫–∏–π –ø—Ä–æ–º–ø—Ç):

    * –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –ª–∏ summary –ø—Ä–æ—Ñ–∏–ª—é,
    * –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç –ø–æ—Ç–µ—Ä—é –¥–µ–¥–ª–∞–π–Ω–æ–≤/—Ä–µ—à–µ–Ω–∏–π,
    * –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç summary –¥–æ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞.
28. –†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –¥–µ–ª–∞–π ¬´—Ä–µ—Å–∏–Ω–∫¬ª: –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ `top` —Å –Ω—É–ª—è –∏–∑ —ç–ø–∏–∑–æ–¥–æ–≤.

## 11) –õ–∏–º–∏—Ç—ã –∏ –æ—Ç—Å–µ—á–∫–∏

29. –ñ—ë—Å—Ç–∫–∏–µ –ª–∏–º–∏—Ç—ã:

    * rolling ‚â§ 800 —Ç–æ–∫–µ–Ω–æ–≤,
    * top ‚â§ 500,
    * profile-dump ‚â§ 250,
    * RAG –≤—Å—Ç–∞–≤–∫–∞ ‚â§ 200,
    * —Å—É–º–º–∞—Ä–Ω–æ ‚â§ 1000.
30. –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ –≤–ª–∞–∑–∏—Ç ‚Äî –∏—Å–∫–ª—é—á–∞–π RAG –Ω–∞ —ç—Ç–æ—Ç —à–∞–≥.

## 12) –ü—Ä–æ–º–ø—Ç-—Å–∫–µ–ª–µ—Ç—ã (–∫—Ä–∞—Ç–∫–æ)

31. **Summarizer (diff-mode):** ¬´–°—Ç–∞—Ä—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç (‚â§X). –ù–æ–≤—ã–µ —Ä–µ–ø–ª–∏–∫–∏. –û–±–Ω–æ–≤–∏, —Å–æ—Ö—Ä–∞–Ω–∏ —Ñ–∞–∫—Ç—ã/—Ä–µ—à–µ–Ω–∏—è/TODO, —É–¥–∞–ª–∏ —à—É–º, –ø–æ–º–µ—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–µ–µ –∫–∞–∫ `outdated`. –í–µ—Ä–Ω–∏ ‚â§X.¬ª
32. **Profiler:** ¬´–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π JSON-–ø—Ä–æ—Ñ–∏–ª—å + –Ω–æ–≤—ã–µ —Ä–µ–ø–ª–∏–∫–∏. –û–±–Ω–æ–≤–∏ —Ç–æ–ª—å–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –ø–æ–ª—è, –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Ä–µ—à–∞–π –≤ –ø–æ–ª—å–∑—É –±–æ–ª–µ–µ —Å–≤–µ–∂–µ–≥–æ/–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ, —Å–æ—Ö—Ä–∞–Ω—è–π `provenance`.¬ª
33. **Retriever:** ¬´–¢–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å + –∫–∞–Ω–¥–∏–¥–∞—Ç—ã. –í—ã–±–µ—Ä–∏ –¥–æ M –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–ª–µ–∑–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å —É—á—ë—Ç–æ–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏/—Å–≤–µ–∂–µ—Å—Ç–∏/–Ω–µ–ø–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç–∏. –í–µ—Ä–Ω–∏ ids.¬ª

## 13) –ú–µ—Ç—Ä–∏–∫–∏ –∏ –∞–ª–µ—Ä—Ç—ã

34. –ü–æ–∫—Ä—ã—Ç–∏–µ: % –æ—Ç–≤–µ—Ç–æ–≤, –≥–¥–µ RAG –≤–Ω—ë—Å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫–æ–Ω—Ç–µ–Ω—Ç–Ω—ã–π —Ñ–∞–∫—Ç.
35. Drift: —á–∞—Å—Ç–æ—Ç–∞ –ø—Ä–∞–≤–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ¬´—Ç—ã –∑–∞–±—ã–ª / —ç—Ç–æ –Ω–µ–≤–µ—Ä–Ω–æ¬ª.
36. –°–∂–∞—Ç–∏–µ: —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä rolling/top –ø–æ—Å–ª–µ —Ç—Ä–∏–º–º–∏–Ω–≥–∞.
37. –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã: —á–∏—Å–ª–æ –∑–∞–º–µ–Ω –≤ –ø—Ä–æ—Ñ–∏–ª–µ/—Ä–µ—à–µ–Ω–∏—è—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥.
38. –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: p95 –≤—Ä–µ–º–µ–Ω–∏ —Å–±–æ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –æ—Ç–≤–µ—Ç–∞.
39. –ê–ª–µ—Ä—Ç—ã: —Ä–æ—Å—Ç drift > X% –∏–ª–∏ –ø—Ä–æ—Ñ–∞–π–ª –º–µ–Ω—è–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ.

## 14) –¢–µ—Å—Ç-–∫–µ–π—Å—ã (—Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)

40. –î–∞–ª—å–Ω–∏–π —Ñ–∞–∫—Ç: –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—å –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è 3 –Ω–µ–¥–µ–ª–∏ –Ω–∞–∑–∞–¥ –ø–æ–ø–∞–¥–∞–µ—Ç —á–µ—Ä–µ–∑ RAG.
41. –ü–µ—Ä–µ–æ–±—É–≤–∞–Ω–∏–µ: ¬´—Ö–æ—á—É X ‚Üí —Ö–æ—á—É Y¬ª ‚Äî –ø—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω, —Å—Ç–∞—Ä–æ–µ –ø–æ–º–µ—á–µ–Ω–æ outdated.
42. –ü–µ—Ä–µ–≥—Ä—É–∑: –¥–ª–∏–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥ –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ 1000 —Ç–æ–∫–µ–Ω–æ–≤.
43. –°–º–µ–Ω–∞ —Ç–µ–º—ã: —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤—ã–π —ç–ø–∏–∑–æ–¥, —Å—Ç–∞—Ä—ã–π —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è.
44. –î–µ–¥–ª–∞–π–Ω: TODO –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Å—Ç–∞—ë—Ç—Å—è –≤–∏–¥–∏–º—ã–º –≤ structured –±–ª–æ–∫–µ.

## 15) –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∏—Å—Ç–æ—Ä–∏–∏

45. –ë—ç–∫—Ñ–∏–ª–ª —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
46. –†–µ—Ç—Ä–æ-—ç–ø–∏–∑–æ–¥—ã: —Ä–∞–∑—Ä–µ–∂—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ –ø–∞—É–∑–∞–º/—Ç–µ–º–∞–º, —Å–æ–∑–¥–∞–π short\_summary.
47. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –ø–µ—Ä–≤–∏—á–Ω—ã–π `top` –∏–∑ short\_summary.

## 16) –≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è –∏ —Ñ–µ–π–ª-—Å–µ–π—Ñ—ã

48. –ï—Å–ª–∏ summarizer –¥–∞–ª –ø—É—Å—Ç—ã—à–∫—É/–µ—Ä—É–Ω–¥—É ‚Äî –æ—Ç–∫–∞—Ç–∏—Å—å –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é.
49. –°–æ—Ö—Ä–∞–Ω—è–π –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –≤–µ—Ä—Å–∏–∏ rolling/top (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ).
50. –õ–æ–≥–∏ –ø—Ä–æ–≤–µ–Ω–∞–Ω—Å–∞: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–∫—Ç–∞ –≤ –ø—Ä–æ—Ñ–∏–ª–µ ‚Äî —Å–ø–∏—Å–æ–∫ message\_ids.

---

–ï—Å–ª–∏ –ø–æ–π–¥—ë–º –ø–æ —ç—Ç–æ–º—É —Å–ø–∏—Å–∫—É —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑, —É —Ç–µ–±—è –ø–æ–ª—É—á–∏—Ç—Å—è —É—Å—Ç–æ–π—á–∏–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ ¬´–Ω–µ –∑–∞–±—ã–≤–∞—é, –Ω–æ –Ω–µ —Ä–∞–∑–¥—É–≤–∞—é –∫–æ–Ω—Ç–µ–∫—Å—Ç¬ª: —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ—Ç—ã –¥–µ—Ä–∂–∞—Ç –∫—Ä–∏—Ç–∏—á–Ω–æ–µ, rolling/top –¥–∞—é—Ç –æ–±–∑–æ—Ä, RAG –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –¥–∞–ª—ë–∫–∏–µ –¥–µ—Ç–∞–ª–∏, –∞ –±—é–¥–∂–µ—Ç–µ—Ä –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–µ—Ä–∂–∞—Ç –≤—Å—ë –≤ 1000 —Ç–æ–∫–µ–Ω–æ–≤.

–•–æ—Ä–æ—à–æ üëç
–ù–∏–∂–µ —è —Å–æ–±—Ä–∞–ª –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ –≥–∏–±—Ä–∏–¥–Ω–æ–π –ø–∞–º—è—Ç–∏. –û–Ω–∏ –¥–∞–Ω—ã –∫–∞–∫ **—à–∞–±–ª–æ–Ω—ã**, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –º–æ–∂–µ—à—å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Å–≤–æ—é –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, GPT-4o-mini –∏–ª–∏ GPT-5).

---

# üîπ 1. Summarizer (—Å–∫–æ–ª—å–∑—è—â–µ–µ —Ä–µ–∑—é–º–µ, diff-mode)

**–í—Ö–æ–¥:**

* `old_summary` (—Ç–µ–∫—Å—Ç ‚â§ 800 —Ç–æ–∫–µ–Ω–æ–≤)
* `new_messages` (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 5‚Äì10 —Å–æ–æ–±—â–µ–Ω–∏–π –¥–∏–∞–ª–æ–≥–∞)

**–ü—Ä–æ–º–ø—Ç:**

```
–¢—ã ‚Äî –∞–≥–µ–Ω—Ç-—Å–∞–º–º–∞—Ä–∏–∑–∞—Ç–æ—Ä –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤. 
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –∫—Ä–∞—Ç–∫–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç –≤—Å–µ–π –±–µ—Å–µ–¥—ã.

–ü—Ä–∞–≤–∏–ª–∞:
- –ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞—Ä–æ–µ —Ä–µ–∑—é–º–µ –∫–∞–∫ –æ—Å–Ω–æ–≤—É.
- –î–æ–±–∞–≤—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Ñ–∞–∫—Ç—ã, –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏, —Ä–µ—à–µ–Ω–∏—è –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
- –£–±–µ—Ä–∏ –Ω–µ–≤–∞–∂–Ω–æ–µ –∏ –ø–æ–≤—Ç–æ—Ä—ã.
- –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å—Ç–∞–ª–∞ –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω–æ–π (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω–∏–ª –º–Ω–µ–Ω–∏–µ, –æ—Ç–º–µ–Ω–∏–ª —Ä–µ—à–µ–Ω–∏–µ) ‚Äî –æ—Ç–º–µ—Ç—å –∫–∞–∫ "outdated".
- –ò—Ç–æ–≥–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ‚â§ 800 —Ç–æ–∫–µ–Ω–æ–≤.

–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
[OLD SUMMARY]
{old_summary}

[NEW MESSAGES]
{new_messages}

–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç:
```

---

# üîπ 2. Profiler (—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –≤ JSON)

**–í—Ö–æ–¥:**

* `existing_profile` (JSON)
* `new_messages` (—Ä–µ–ø–ª–∏–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞/–±–æ—Ç–∞)

**–ü—Ä–æ–º–ø—Ç:**

```
–¢—ã ‚Äî –∞–≥–µ–Ω—Ç-–ü—Ä–æ—Ñ–∞–π–ª–µ—Ä. 
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π. 
–§–æ—Ä–º–∞—Ç —Å—Ç—Ä–æ–≥–æ JSON.

–ü—Ä–∞–≤–∏–ª–∞:
- –°–æ—Ö—Ä–∞–Ω—è–π –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –Ω–æ–≤—ã–º.
- –ù–æ–≤—ã–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è –∑–∞–º–µ–Ω—è—é—Ç —Å—Ç–∞—Ä—ã–µ (–µ—Å–ª–∏ –æ–Ω–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–µ–µ –∏–ª–∏ —Å–≤–µ–∂–µ–µ).
- –†–∞—Å–ø–ª—ã–≤—á–∞—Ç—ã–µ –∏–ª–∏ –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞—Ç–∏—Ä–∞—Ç—å —Ç–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
- –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –∏–∑–º–µ–Ω–∏–ª —Ä–µ—à–µ–Ω–∏–µ, —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–º–µ—á–∞–π –∫–∞–∫ "outdated" (–≤ –ø–æ–ª–µ "status" –∏–ª–∏ —Ä—è–¥–æ–º).
- –î–æ–±–∞–≤–ª—è–π –ø–æ–ª–µ "provenance" ‚Äî id —Å–æ–æ–±—â–µ–Ω–∏–π, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –≤–∑—è—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.

–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
EXISTING_PROFILE:
{existing_profile}

NEW_MESSAGES:
{new_messages}

–í—ã–≤–µ–¥–∏ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π JSON –ø—Ä–æ—Ñ–∏–ª—è:
```

---

# üîπ 3. Retriever (RAG-–≤—Å—Ç–∞–≤–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ä–µ–ø–ª–∏–∫)

**–í—Ö–æ–¥:**

* `current_user_message`
* —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ (—Å—Ç–∞—Ä—ã–µ —Ä–µ–ø–ª–∏–∫–∏ —Å id, —Ç–µ–∫—Å—Ç–æ–º, —ç–º–±–µ–¥–¥–∏–Ω–≥-score, –¥–∞—Ç–æ–π)

**–ü—Ä–æ–º–ø—Ç:**

```
–¢—ã ‚Äî –∞–≥–µ–Ω—Ç-–ø–æ–∏—Å–∫–æ–≤–∏–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞.
–ó–∞–¥–∞—á–∞: –≤—ã–±—Ä–∞—Ç—å –¥–æ 5 –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–ª–µ–∑–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –º–æ–¥–µ–ª–∏.

–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–±–æ—Ä–∞:
- –í—ã—Å–æ–∫–∞—è —Å–º—ã—Å–ª–æ–≤–∞—è –±–ª–∏–∑–æ—Å—Ç—å –∫ —Ç–µ–∫—É—â–µ–º—É –∑–∞–ø—Ä–æ—Å—É.
- –°–≤–µ–∂–µ—Å—Ç—å (–Ω–æ–≤–µ–µ ‚Äî —Ü–µ–Ω–Ω–µ–µ).
- –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ: –Ω–µ –≤—ã–±–∏—Ä–∞–π –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø–æ —Å–º—ã—Å–ª—É.
- –ò–≥–Ω–æ—Ä–∏—Ä—É–π –º–µ–ª–∫–∏–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è –∏ —à—É–º.

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: JSON –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤
[
  { "id": ..., "reason": "..." },
  ...
]

–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
–¢–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
{current_user_message}

–ö–∞–Ω–¥–∏–¥–∞—Ç—ã:
{candidate_messages}

–í—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
```

---

# üîπ 4. Validator (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏)

**–í—Ö–æ–¥:**

* `summary`
* `profile`

**–ü—Ä–æ–º–ø—Ç:**

```
–¢—ã ‚Äî –∞–≥–µ–Ω—Ç-–≤–∞–ª–∏–¥–∞—Ç–æ—Ä –ø–∞–º—è—Ç–∏. 
–ó–∞–¥–∞—á–∞: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∫–æ–Ω—Å–ø–µ–∫—Ç–∞ –∏ –ø—Ä–æ—Ñ–∏–ª—è.

–ü—Ä–∞–≤–∏–ª–∞:
- –ï—Å–ª–∏ –≤ summary —É–ø–æ–º–∏–Ω–∞—é—Ç—Å—è —Ñ–∞–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –ø—Ä–æ—Ñ–∏–ª–µ, –ø—Ä–µ–¥–ª–æ–∂–∏ –∏—Ö –¥–æ–±–∞–≤–∏—Ç—å.
- –ï—Å–ª–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ –µ—Å—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è), –ø–æ–º–µ—Ç—å –∏—Ö –∫–∞–∫ "outdated".
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ summary –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç (‚â§ 800 —Ç–æ–∫–µ–Ω–æ–≤).
- –í–µ—Ä–Ω–∏ —Å–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –≤ JSON:
[
  { "issue": "–æ–ø–∏—Å–∞–Ω–∏–µ", "suggested_fix": "..." }
]
–ï—Å–ª–∏ –≤—Å—ë –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚Äî –≤–µ—Ä–Ω–∏ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ [].
```

---

# üîπ 5. Top-summary (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π —Ä–µ—Å–∏–Ω–∫)

**–í—Ö–æ–¥:**

* —Å–ø–∏—Å–æ–∫ `episode_summaries` (–∫–∞–∂–¥—ã–π ‚â§ 200 —Ç–æ–∫–µ–Ω–æ–≤)

**–ü—Ä–æ–º–ø—Ç:**

```
–¢—ã ‚Äî –∞–≥–µ–Ω—Ç-–≥–ª–∞–≤–Ω—ã–π —Å–∞–º–º–∞—Ä–∏–∑–∞—Ç–æ—Ä. 
–ó–∞–¥–∞—á–∞: —Å–æ–±—Ä–∞—Ç—å –≤–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤–æ–µ —Ä–µ–∑—é–º–µ –¥–∏–∞–ª–æ–≥–∞ –∏–∑ –∫—Ä–∞—Ç–∫–∏—Ö —ç–ø–∏–∑–æ–¥–æ–≤.

–ü—Ä–∞–≤–∏–ª–∞:
- –û–±—ä–µ–¥–∏–Ω–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –≤—Å–µ—Ö —ç–ø–∏–∑–æ–¥–æ–≤.
- –£–∫–∞–∂–∏ –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç—ã, —Ä–µ—à–µ–Ω–∏—è, –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏.
- –ò–≥–Ω–æ—Ä–∏—Ä—É–π –º–µ–ª–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ñ—Ä–∞–∑—ã.
- –ò—Ç–æ–≥–æ–≤—ã–π —Ç–µ–∫—Å—Ç ‚â§ 500 —Ç–æ–∫–µ–Ω–æ–≤.

–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
{episode_summaries}

–°—Ñ–æ—Ä–º–∏—Ä—É–π –∏—Ç–æ–≥–æ–≤–æ–µ —Ä–µ–∑—é–º–µ:
```

---

# üìå –ò—Ç–æ–≥

–£ —Ç–µ–±—è –±—É–¥–µ—Ç 5 —Ç–∏–ø–æ–≤ –ø—Ä–æ–º–ø—Ç–æ–≤:

1. **Summarizer** ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç rolling summary (–∫—Ä–∞—Ç–∫–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏).
2. **Profiler** ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON-–ø—Ä–æ—Ñ–∏–ª—å.
3. **Retriever** ‚Äî –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Å—Ç–∞—Ä—ã–µ —Ä–µ–ø–ª–∏–∫–∏.
4. **Validator** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏ –ª–∏–º–∏—Ç—ã.
5. **Top-summary** ‚Äî –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –≤–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤—ã–π –æ–±–∑–æ—Ä.

---

